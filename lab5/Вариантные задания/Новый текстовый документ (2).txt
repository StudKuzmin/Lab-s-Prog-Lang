#include <iostream>
#include <ctime>
#include <fstream>
#include <string>
#include <windows.h>

using namespace std;




struct bus
{
	int bus_number;		// Номер автобуса
	int route_number;	// Номер маршрута
	int time;			// Продолжительность 1 круга
	string FIO;			// ФИО

};

void inf_bus(int* bs_nmbr, int* rt_nmbr, int* tm, char** F, bus* mas_bus, int f) // Функция вывода информации об автобусах на экран
{
	ifstream fin("C:\\Users\\MubaTwo\\Desktop\\file\\lab5\\Park\\InfoRec.txt"); if (!fin) cout << "Ошибка открытия файла InfoRec.txt" << endl;

	char symbol; int i = 0; int j = 0;
	char* str = new char[1000];

	while (fin.get(symbol))
	{
		str[i] = symbol; cout << str[i];
		i++;
	}

	cout << endl;

	ifstream fin2("C:\\Users\\MubaTwo\\Desktop\\file\\lab5\\Park\\InfoRec.txt"); if (!fin2) cout << "Ошибка открытия файла InfoRec.txt" << endl;

	for (int i = 0; i < f; i++)
	{
		fin2 >> bs_nmbr[i]; cout << bs_nmbr[i] << endl;
	}




	fin.close();
	fin2.close();
}

/*
void petrov_route(int f, bus* mas_bus) // Функция, которая ищет маршруты Петрова
{
	int count = 0;

	for (int i = 0; i < f; i++)
	{
		if (mas_bus[i].FIO == "Petrov_Ivan_Alekseevich")
		{
			cout << "Маршрут(ы) Петрова: " << mas_bus[i].route_number << endl;
			count++;
		}
		if (i == f - 1 && count == 0) cout << "Нет водителя с фамилией Петров." << endl;
	}

}

void long_route(int f, bus* mas_bus) // Выводим информацию о всех автобусах с длинными маршрутами и сортируем данные по фамилии водителя
{
	int* m = new int[f]; // Массив количества автобусов(нумерация)
	for (int i = 0; i < f; i++)
	{
		m[i] = i + 1;
	}

	for (int i = 0; i < f; i++)		 // Сортируем данные по фамилии водителей по возрастанию
	{
		for (int i = 0; i < f - 1; i++)
		{
			if (mas_bus[i].FIO > mas_bus[i + 1].FIO) // Если "данный" чаровый элемент > "следующего" чарового элемента, меняем все данные местами.
			{
				swap(mas_bus[i].FIO, mas_bus[i + 1].FIO);
				swap(mas_bus[i].route_number, mas_bus[i + 1].route_number);
				swap(mas_bus[i].bus_number, mas_bus[i + 1].bus_number);
				swap(mas_bus[i].time, mas_bus[i + 1].time);
				swap(m[i], m[i + 1]);
			}
		}
	}

	for (int i = 0; i < f; i++)
	{
		if (mas_bus[i].time > 60) // Если продолжительность 1круга > 60 минут, выводим данные на экран
		{
			cout << endl << "Автобус № " << m[i] << endl;
			cout << "Номер автобуса:\t\t\t " << mas_bus[i].bus_number << endl;
			cout << "Номер Маршрута:\t\t\t " << mas_bus[i].route_number << endl;
			cout << "Продолжительность 1 круга:\t " << mas_bus[i].time << "m." << endl;
			cout << "ФИО водителя:\t\t\t " << mas_bus[i].FIO << endl;
		}
	}

}
*/

void rec(int* recm, int* recr, int* rect, char** fm, int f) // Функция записи именно стольких объектов, сколько сгенерировала переменная f
{
	ofstream rec("C:\\Users\\MubaTwo\\Desktop\\file\\lab5\\Park\\InfoREC.txt"); if (!rec) cout << "Ошибка открытия файла InfoREC.txt" << endl;

	ifstream read_bus_number("C:\\Users\\MubaTwo\\Desktop\\file\\lab5\\Park\\Номера автобусов.txt"); if (!read_bus_number) cout << "Ошибка открытия файла Номера автобусов.txt" << endl;
	ifstream read_route_number("C:\\Users\\MubaTwo\\Desktop\\file\\lab5\\Park\\Номера маршрутов.txt"); if (!read_route_number) cout << "Ошибка открытия файла Номера маршрутов.txt" << endl;
	ifstream read_time("C:\\Users\\MubaTwo\\Desktop\\file\\lab5\\Park\\Продолжительность.txt"); if (!read_time) cout << "Ошибка открытия файла Продолжительность.txt" << endl;
	ifstream read_FIO("C:\\Users\\MubaTwo\\Desktop\\file\\lab5\\Park\\ФИО водителей.txt"); if (!read_FIO) cout << "Ошибка открытия файла ФИО водителей.txt" << endl;

	for (int i = 0; i < f; i++) // Считываем номера автобусов.txt в массив bs_nmbr
	{
		read_bus_number >> recm[i];
	}
	cout << "$$$" << endl;
	for (int i = 0; i < f; i++) // Считываем номера маршрутов.txt в массив rt_nmbr
	{
		read_route_number >> recr[i]; 
	}
	cout << "$$$" << endl;
	for (int i = 0; i < f; i++) // Считываем Продолжительность.txt в массив tm
	{
		read_time >> rect[i]; 
	}
	cout << "$$$" << endl;
	for (int i = 0; i < f; i++) // Считываем ФИО водителей.txt в массив F
	{
		read_FIO >> fm[i]; 
	}
	cout << "$$$" << endl;

	read_bus_number.close();
	read_route_number.close();
	read_time.close();
	read_FIO.close();

	for (int i = 0; i < f; i++) // Записываем номера автобусов в файл1
	{
		if (i == f - 1)
		{
			rec << recm[i] << endl;
			break;
		}
		rec << recm[i] << " "; 
	}

	for (int i = 0; i < f; i++) // записываем номера маршрутов в файл1
	{
		if (i == f - 1)
		{
			rec << recr[i] << endl;
			break;
		}
		rec << recr[i] << " ";
	}

	for (int i = 0; i < f; i++) // Записываем продолжительность в файл1
	{
		if (i == f - 1)
		{
			rec << rect[i] << endl;
			break;
		}
		rec << rect[i] << " ";
	}
	

	for (int i = 0; i < f; i++) // Записываем ФИО в файл1
	{
		if (i == f - 1)
		{
			rec << fm[i];
			break;
		}
		rec << fm[i] << endl;
	}

	rec.close();
}


int main()
{
	setlocale(LC_ALL, "ru"); srand(time(0));
	int f = 1 + rand() % 15;			// Ограничиваем количество автобусов до 15
	cout << "Размер: " << f << endl;

	int* recm = new int[f]; int* recr = new int[f]; int* rect = new int[f]; char** fm = new char* [f];
	for (int i = 0; i < f; i++)
	{
		fm[i] = new char[100];
	}

	rec(recm, recr, rect, fm, f);


	bus* mas_bus = new bus[f];			// Создаём массив структур

	int* bs_nmbr = new int[f]; int* rt_nmbr = new int[f]; int* tm = new int[f]; char** F = new char* [f]; // Отдельные массивы для каждого файла
	for (int i = 0; i < f; i++)
	{
		F[i] = new char[100];
	}

	inf_bus(bs_nmbr, rt_nmbr, tm, F, mas_bus, f);	// Функция вывода информации об автобусах на экран
	cout << "\n######################################################\n\n";
	//petrov_route(f, mas_bus);					// Функция, которая ищет маршруты Петрова. Вывод результата на экран.
	cout << "\n######################################################\n\n";
	//long_route(f, mas_bus);						// Функция сортировки данных по фамилии водителей. Вывод результата на экран



	delete[] bs_nmbr;
	delete[] rt_nmbr;
	delete[] tm;
	delete[] F;
	delete[] mas_bus;

	return 0;
}